<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎯 AOE Clicking Trainer - JOMA Gaming</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="images_web/jomac.png" type="image/x-icon">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Entrena tu velocidad y precisión de clicking para dominar Age of Empires. Trainer especializado para mejorar APM y micro-management.">
    <meta name="keywords" content="AOE trainer, clicking trainer, Age of Empires, APM training, micro management, gaming trainer">
    <meta name="author" content="José María García Márquez - JOMA Gaming">
</head>
<body>
    <header class="header">
        <nav class="nav container">
            <a href="gaming.html" class="logo">
                <img src="images_web/jomac.png" alt="JOMA Gaming">
                JOMA 🎮
            </a>
            <ul class="nav-links">
                <li><a href="gaming.html">Gaming</a></li>
                <li><a href="games.html">Mis Juegos</a></li>
                <li><a href="dev-games.html">Desarrollo</a></li>
                <li><a href="gaming-blog.html">Diario Noob</a></li>
                <li><a href="gaming-material.html">Guías</a></li>
                <li><a href="clicking-trainer.html" class="active">🎯 Trainer</a></li>
            </ul>
            <button class="menu-toggle">☰</button>
        </nav>
    </header>

    <section class="hero">
        <div class="container">
            <div class="breadcrumb">
                <a href="gaming.html">Gaming</a> 
                <span>›</span> 
                <span>AOE Clicking Trainer</span>
            </div>
            <h1>🎯 AOE Clicking Trainer</h1>
            <p class="subtitle">Entrena como un Pro Player de Age of Empires</p>
            <p class="description">
                Mejora tu velocidad y precisión de clicking para dominar el micro-management en AOE. 
                Desde clicking básico hasta entrenamiento avanzado de multitasking. 
                <strong>¡Transforma tu APM y conviértete en un pro!</strong> 🚀
            </p>
        </div>
    </section>

    <main class="container">
        <!-- Modos de Entrenamiento -->
        <section class="section">
            <div class="section-title">🎮 Modos de Entrenamiento</div>
            <div class="section-subtitle">Diferentes ejercicios para mejorar aspectos específicos de tu gameplay</div>
            
            <div class="grid grid-3">
                <!-- Modo Básico -->
                <div class="card trainer-mode" data-mode="basic">
                    <div class="card-icon">🎯</div>
                    <h3>Clicking Básico</h3>
                    <p>Entrena velocidad y precisión básica. Perfecto para empezar tu journey hacia pro player.</p>
                    <ul class="features-list">
                        <li>🎯 Targets individuales</li>
                        <li>⏱️ Tiempo configurable</li>
                        <li>📊 Estadísticas detalladas</li>
                        <li>🏆 Sistema de ranking AOE</li>
                    </ul>
                    <button class="btn btn-primary mode-btn" data-mode="basic">🚀 Entrenar</button>
                </div>

                <!-- Modo Micro -->
                <div class="card trainer-mode" data-mode="dodge">
                    <div class="card-icon">🏃‍♂️</div>
                    <h3>Control de Unidad - Dodge</h3>
                    <p>Controla una unidad esquivando proyectiles como en AOE. Mejora tus reflejos y micromanagement.</p>
                    <ul class="features-list">
                        <li>�️ Control con click derecho</li>
                        <li>💣 Proyectiles escalables</li>
                        <li>⚡ Entrenamiento de reflejos</li>
                        <li>� Tiempo de reacción</li>
                    </ul>
                    <button class="btn btn-primary mode-btn" data-mode="dodge">🏃‍♂️ Entrenar Dodge</button>
                </div>

                <!-- Modo Multitasking -->
                <div class="card trainer-mode" data-mode="formations">
                    <div class="card-icon">🔄</div>
                    <h3>Formaciones Dinámicas</h3>
                    <p>Cambia formaciones para evitar daño de área. Simula gestión de ejércitos en AOE.</p>
                    <ul class="features-list">
                        <li>🔄 Cambio de formaciones</li>
                        <li>💥 Daño de área</li>
                        <li>🎯 Múltiples unidades</li>
                        <li>📈 Análisis de supervivencia</li>
                    </ul>
                    <button class="btn btn-secondary mode-btn" data-mode="formations">🔄 Próximamente</button>
                </div>
            </div>
        </section>
                </div>
            </div>
        </section>

        <!-- Área de Entrenamiento Principal -->
        <section class="section" id="training-section">
            <div class="section-title">🎯 Área de Entrenamiento</div>
            
            <div class="grid grid-2">
                <!-- Panel de Configuración -->
                <div class="card">
                    <div class="card-icon">⚙️</div>
                    <h3>Configuración del Entrenamiento</h3>
                    <div class="trainer-controls">
                        <!-- Controles para modo básico -->
                        <div id="basic-controls" class="mode-controls">
                            <div class="control-group">
                                <label for="difficulty">Dificultad:</label>
                                <select id="difficulty">
                                    <option value="noob">🥉 Noob (30 targets)</option>
                                    <option value="intermediate" selected>🥈 Intermediate (50 targets)</option>
                                    <option value="advanced">🥇 Advanced (100 targets)</option>
                                    <option value="pro">💎 Pro (150 targets)</option>
                                    <option value="insane">🔥 Insane (200 targets)</option>
                                    <option value="godlike">⚡ Godlike (300 targets)</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label for="time-limit">Tiempo límite:</label>
                                <select id="time-limit">
                                    <option value="30">30 segundos</option>
                                    <option value="60" selected>60 segundos</option>
                                    <option value="120">2 minutos</option>
                                    <option value="300">5 minutos</option>
                                    <option value="600">10 minutos</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label for="target-size">Tamaño del target:</label>
                                <select id="target-size">
                                    <option value="micro">Micro (8px) - Insane Pro</option>
                                    <option value="tiny">Tiny (12px) - Pro Mode</option>
                                    <option value="small">Small (18px) - Hard</option>
                                    <option value="medium" selected>Medium (25px) - Normal</option>
                                    <option value="large">Large (35px) - Easy</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label for="spawn-rate">Velocidad de spawn:</label>
                                <select id="spawn-rate">
                                    <option value="slow">Lento (1.5s)</option>
                                    <option value="normal" selected>Normal (1s)</option>
                                    <option value="fast">Rápido (0.7s)</option>
                                    <option value="insane">Insano (0.4s)</option>
                                    <option value="lightning">Lightning (0.2s) - Pro Only</option>
                                </select>
                            </div>
                        </div>

                        <!-- Controles para modo dodge -->
                        <div id="dodge-controls" class="mode-controls" style="display: none;">
                            <div class="control-group">
                                <label for="dodge-difficulty">Dificultad:</label>
                                <select id="dodge-difficulty">
                                    <option value="easy">🥉 Fácil (Projectiles lentos)</option>
                                    <option value="normal" selected>🥈 Normal (Velocidad estándar)</option>
                                    <option value="hard">🥇 Difícil (Proyectiles rápidos)</option>
                                    <option value="extreme">💎 Extremo (Velocidad máxima)</option>
                                    <option value="nightmare">🔥 Pesadilla (Modo pro)</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label for="dodge-time-limit">Tiempo límite:</label>
                                <select id="dodge-time-limit">
                                    <option value="30">30 segundos</option>
                                    <option value="60" selected>60 segundos</option>
                                    <option value="120">2 minutos</option>
                                    <option value="300">5 minutos</option>
                                    <option value="600">10 minutos</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label for="unit-speed">Velocidad de unidad:</label>
                                <select id="unit-speed">
                                    <option value="slow">Lenta (Principiante)</option>
                                    <option value="normal" selected>Normal (Recomendado)</option>
                                    <option value="fast">Rápida (Avanzado)</option>
                                    <option value="lightning">Relámpago (Pro)</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label for="projectile-count">Máx. proyectiles:</label>
                                <select id="projectile-count">
                                    <option value="3">3 proyectiles</option>
                                    <option value="5" selected>5 proyectiles</option>
                                    <option value="8">8 proyectiles</option>
                                    <option value="12">12 proyectiles</option>
                                    <option value="15">15 proyectiles</option>
                                </select>
                            </div>
                        </div>

                        <button id="start-trainer" class="btn btn-primary">🚀 Iniciar Entrenamiento</button>
                        <button id="reset-trainer" class="btn btn-outline" style="display: none;">🔄 Reiniciar</button>
                    </div>
                </div>

                <!-- Estadísticas en Tiempo Real -->
                <div class="card">
                    <div class="card-icon">📊</div>
                    <h3>Estadísticas en Vivo</h3>
                    <div class="trainer-stats" id="trainer-stats">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="clicks-count">0</div>
                                <div class="stat-label">Total Clicks</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="hits-count">0</div>
                                <div class="stat-label">Hits</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="misses-count">0</div>
                                <div class="stat-label">Misses</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="accuracy">100%</div>
                                <div class="stat-label">Precisión</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="cps-live">0.0</div>
                                <div class="stat-label">CPS Actual</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="time-remaining">60</div>
                                <div class="stat-label">Tiempo (s)</div>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="time-progress"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Previsualización del Entrenamiento -->
            <div class="card game-card">
                <div class="card-icon">🎮</div>
                <h3>🎯 Previsualización - Entrenamiento Fullscreen</h3>
                <div id="game-area" class="preview-game-area">
                    <div class="preview-overlay">
                        <div class="preview-content">
                            <div class="preview-icon">🖥️</div>
                            <h4 id="preview-title">Entrenamiento de Micromanagement AOE</h4>
                            <p id="preview-description">El entrenamiento se ejecutará en <strong>pantalla completa</strong> para una experiencia inmersiva como un profesional de AOE.</p>
                            
                            <div id="preview-features" class="preview-features">
                                <div class="preview-feature">
                                    <span class="feature-icon">📊</span>
                                    <span>HUD con estadísticas en tiempo real</span>
                                </div>
                                <div class="preview-feature">
                                    <span class="feature-icon">🎯</span>
                                    <span>Targets optimizados para micromanagement</span>
                                </div>
                                <div class="preview-feature">
                                    <span class="feature-icon">⚡</span>
                                    <span>Feedback visual inmediato</span>
                                </div>
                                <div class="preview-feature">
                                    <span class="feature-icon">🏆</span>
                                    <span>Sistema de ranking profesional</span>
                                </div>
                            </div>
                            
                            <div class="micro-tips">
                                <h5>💡 Tips de Micromanagement:</h5>
                                <ul>
                                    <li>🖱️ Movimientos cortos y precisos</li>
                                    <li>⚡ 3+ CPS para ranked competitivo</li>
                                    <li>🎯 +80% precisión es esencial</li>
                                    <li>🧘 Consistencia > velocidad pura</li>
                                </ul>
                            </div>
                            
                            <button id="start-trainer-preview" class="btn-fullscreen-preview">
                                � Iniciar Entrenamiento Fullscreen
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Stats ocultas (solo para JavaScript) -->
                <div class="hidden-stats" style="display: none;">
                    <span id="clicks-count">0</span>
                    <span id="hits-count">0</span>
                    <span id="misses-count">0</span>
                    <span id="accuracy">100%</span>
                    <span id="cps-live">0.0</span>
                    <span id="time-remaining">60</span>
                    <div id="time-progress"></div>
                </div>
                
                <button id="reset-trainer" class="btn btn-outline" style="display: none;">
                    🔄 Reiniciar
                </button>
            </div>
        </section>

        <!-- Área de Juego Fullscreen -->
        <div id="fullscreen-game" class="fullscreen-game-container" style="display: none;">
            <div class="fullscreen-hud">
                <div class="hud-left">
                    <div class="hud-stat">
                        <span class="hud-label">Hits:</span>
                        <span class="hud-value" id="fs-hits">0</span>
                    </div>
                    <div class="hud-stat">
                        <span class="hud-label">CPS:</span>
                        <span class="hud-value" id="fs-cps">0.0</span>
                    </div>
                </div>
                <div class="hud-center">
                    <div class="hud-time">
                        <span id="fs-time">60</span>
                    </div>
                    <div class="hud-progress-bar">
                        <div class="hud-progress-fill" id="fs-progress"></div>
                    </div>
                </div>
                <div class="hud-right">
                    <div class="hud-stat">
                        <span class="hud-label">Precisión:</span>
                        <span class="hud-value" id="fs-accuracy">100%</span>
                    </div>
                    <button id="exit-fullscreen" class="hud-exit-btn">❌ Salir</button>
                </div>
            </div>
            <div id="fullscreen-game-area" class="fullscreen-game-area">
                <!-- Los targets aparecerán aquí -->
            </div>
        </div>

        <!-- Overlay de Resultados Fullscreen -->
        <div id="results-overlay" class="results-overlay" style="display: none;">
            <div class="results-container">
                <div class="results-header">
                    <h2>🏆 Resultados del Entrenamiento</h2>
                    <p>¡Sesión completada! Aquí están tus stats:</p>
                </div>
                
                <div class="results-grid">
                    <div class="result-stat">
                        <div class="stat-icon">🎯</div>
                        <div class="stat-number" id="overlay-accuracy">0%</div>
                        <div class="stat-title">Precisión</div>
                    </div>
                    
                    <div class="result-stat">
                        <div class="stat-icon">⚡</div>
                        <div class="stat-number" id="overlay-cps">0.0</div>
                        <div class="stat-title">CPS</div>
                    </div>
                    
                    <div class="result-stat">
                        <div class="stat-icon">📈</div>
                        <div class="stat-number" id="overlay-apm">0</div>
                        <div class="stat-title">APM</div>
                    </div>
                    
                    <div class="result-stat highlight">
                        <div class="stat-icon">🏆</div>
                        <div class="stat-number" id="overlay-rating">Noob</div>
                        <div class="stat-title">Nivel AOE</div>
                    </div>
                </div>
                
                <div class="results-analysis">
                    <div class="analysis-section">
                        <h4>📊 Análisis</h4>
                        <div id="overlay-analysis"></div>
                    </div>
                    <div class="recommendations-section">
                        <h4>💡 Recomendaciones</h4>
                        <div id="overlay-recommendations"></div>
                    </div>
                </div>
                
                <div class="results-actions">
                    <button id="train-again" class="btn btn-primary">🔄 Entrenar de Nuevo</button>
                    <button id="back-to-trainer" class="btn btn-outline">⚙️ Cambiar Configuración</button>
                    <button id="view-leaderboard" class="btn btn-outline">� Ver Mi Progreso</button>
                </div>
                
                <div class="micro-improvement-section">
                    <h4>🎯 Desarrollo de Micromanagement AOE</h4>
                    <div class="improvement-grid">
                        <div class="improvement-tip">
                            <div class="tip-icon">⚡</div>
                            <div class="tip-content">
                                <strong>Velocidad:</strong> Practica movimientos pequeños y rápidos como en batallas reales de AOE
                            </div>
                        </div>
                        <div class="improvement-tip">
                            <div class="tip-icon">🎯</div>
                            <div class="tip-content">
                                <strong>Precisión:</strong> Mejor 80% preciso que 60% muy rápido - la eficiencia es clave
                            </div>
                        </div>
                        <div class="improvement-tip">
                            <div class="tip-icon">🧘</div>
                            <div class="tip-content">
                                <strong>Consistencia:</strong> Entrena 10-15 min diarios para desarrollo de memoria muscular
                            </div>
                        </div>
                        <div class="improvement-tip">
                            <div class="tip-icon">🏆</div>
                            <div class="tip-content">
                                <strong>Meta AOE:</strong> Objetivo 150-200 APM efectivos para ranked competitivo
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resultados del Entrenamiento -->
        <section class="section" id="results-section" style="display: none;">
            <div class="section-title">🏆 Resultados del Entrenamiento</div>
            
            <div class="grid grid-4">
                <div class="card text-center result-card">
                    <div class="card-icon">🎯</div>
                    <h3 id="final-accuracy">0%</h3>
                    <p>Precisión Final</p>
                </div>
                
                <div class="card text-center result-card">
                    <div class="card-icon">⚡</div>
                    <h3 id="clicks-per-second">0.0</h3>
                    <p>Clicks por Segundo</p>
                </div>
                
                <div class="card text-center result-card">
                    <div class="card-icon">🏆</div>
                    <h3 id="aoe-rating">Noob</h3>
                    <p>Nivel AOE</p>
                </div>
                
                <div class="card text-center result-card">
                    <div class="card-icon">📈</div>
                    <h3 id="apm-equivalent">0</h3>
                    <p>APM Equivalente</p>
                </div>
            </div>

            <!-- Análisis Detallado -->
            <div class="grid grid-2">
                <div class="card">
                    <h4>📊 Análisis de Rendimiento</h4>
                    <div id="performance-analysis">
                        <!-- Se llena dinámicamente -->
                    </div>
                </div>
                
                <div class="card">
                    <h4>💡 Recomendaciones</h4>
                    <div id="recommendations">
                        <!-- Se llena dinámicamente -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Leaderboard Personal -->
        <section class="section" id="leaderboard-section">
            <div class="section-title">🏆 Tus Mejores Records</div>
            <div class="section-subtitle">Historial de entrenamientos y progreso personal</div>
            
            <div class="leaderboard-container">
                <div class="leaderboard-filters">
                    <button class="filter-btn active" data-filter="all">Todos</button>
                    <button class="filter-btn" data-filter="basic">Básico</button>
                    <button class="filter-btn" data-filter="micro">Micro</button>
                    <button class="filter-btn" data-filter="multitask">Multitask</button>
                </div>
                
                <div class="leaderboard-list" id="leaderboard-list">
                    <div class="no-records">
                        <p>🎯 ¡Aún no tienes records!</p>
                        <p>Completa tu primer entrenamiento para empezar a trackear tu progreso.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Guía de Niveles AOE -->
        <section class="section">
            <div class="section-title">📊 Guía de Niveles AOE</div>
            <div class="section-subtitle">Entiende qué significa cada nivel y cómo mejorar</div>
            
            <div class="grid grid-3">
                <div class="card level-guide">
                    <div class="level-icon">🥉</div>
                    <h4>Noob - Beginner</h4>
                    <div class="level-requirements">
                        <p><strong>CPS:</strong> 1.0 - 2.0</p>
                        <p><strong>Precisión:</strong> 40-60%</p>
                        <p><strong>APM Equivalente:</strong> 60-120</p>
                    </div>
                    <p>Empezando el journey. Enfócate en precisión antes que velocidad.</p>
                </div>

                <div class="card level-guide">
                    <div class="level-icon">🥈</div>
                    <h4>Intermediate - Advanced</h4>
                    <div class="level-requirements">
                        <p><strong>CPS:</strong> 2.0 - 3.5</p>
                        <p><strong>Precisión:</strong> 60-80%</p>
                        <p><strong>APM Equivalente:</strong> 120-210</p>
                    </div>
                    <p>Buen progreso. Ya puedes competir en ranked de nivel medio.</p>
                </div>

                <div class="card level-guide">
                    <div class="level-icon">🥇</div>
                    <h4>Expert - Pro Player</h4>
                    <div class="level-requirements">
                        <p><strong>CPS:</strong> 3.5+</p>
                        <p><strong>Precisión:</strong> 80%+</p>
                        <p><strong>APM Equivalente:</strong> 210+</p>
                    </div>
                    <p>¡Nivel profesional! Micromanagement de élite.</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="social-links">
                <a href="https://www.youtube.com/@jomaing" target="_blank">📺</a>
                <a href="https://www.instagram.com/joma_ing" target="_blank">📷</a>
                <a href="https://twitch.tv/chemitas96" target="_blank">🟣</a>
                <a href="https://discord.gg/ZzMU7haa" target="_blank">🎮</a>
                <a href="https://www.linkedin.com/in/josé-maría-garcía-márquez-556a75199" target="_blank">💼</a>
                <a href="https://github.com/JoseMariaGarciaMarquez" target="_blank">💻</a>
                <a href="https://www.reddit.com/user/Chemitatas/" target="_blank">🤖</a>
                <a href="https://www.reddit.com/r/Geofisica/" target="_blank">🌍</a>
            </div>
            <p>&copy; 2024 JOMA Gaming. Todos los derechos reservados.</p>
            <p>Gaming Contact: <a href="https://t.me/Chemitas42">@Chemitas42</a></p>
        </div>
    </footer>

    <script>
        // Menú móvil
        document.querySelector('.menu-toggle').addEventListener('click', () => {
            document.querySelector('.nav-links').classList.toggle('active');
        });

        // ========================================
        // AOE CLICKING TRAINER - FULLSCREEN VERSION
        // ========================================
        
        class AdvancedClickingTrainer {
            constructor() {
                this.gameActive = false;
                this.fullscreenMode = false;
                this.targets = [];
                this.selectedMode = 'basic';
                this.stats = {
                    clicks: 0,
                    hits: 0,
                    misses: 0,
                    startTime: 0,
                    timeLimit: 60,
                    cpsHistory: []
                };
                this.config = {
                    difficulty: 'intermediate',
                    targetSize: 'medium',
                    timeLimit: 60,
                    spawnRate: 'normal'
                };
                
                this.gameArea = document.getElementById('game-area');
                this.fullscreenContainer = document.getElementById('fullscreen-game');
                this.fullscreenGameArea = document.getElementById('fullscreen-game-area');
                this.resultsOverlay = document.getElementById('results-overlay');
                
                console.log('Elements check:');
                console.log('gameArea:', this.gameArea);
                console.log('fullscreenContainer:', this.fullscreenContainer);
                console.log('fullscreenGameArea:', this.fullscreenGameArea);
                console.log('resultsOverlay:', this.resultsOverlay);
                
                this.gameInterval = null;
                this.timer = null;
                this.cpsInterval = null;
                
                this.initializeTrainer();
                this.loadLeaderboard();
                
                // Inicializar modo por defecto
                this.highlightMode('basic');
                this.updatePreview('basic');
            }
            
            initializeTrainer() {
                // Event listeners para controles
                document.getElementById('start-trainer').addEventListener('click', () => {
                    console.log('Start trainer clicked, selectedMode:', this.selectedMode);
                    try {
                        if (this.selectedMode === 'dodge') {
                            console.log('Starting dodge fullscreen');
                            this.startDodgeFullscreen();
                        } else {
                            console.log('Starting basic fullscreen');
                            this.startFullscreenGame();
                        }
                    } catch (error) {
                        console.error('Error starting training:', error);
                        alert('Error al iniciar el entrenamiento: ' + error.message);
                    }
                });
                document.getElementById('reset-trainer').addEventListener('click', () => this.resetGame());
                
                // Config listeners
                document.getElementById('difficulty').addEventListener('change', (e) => this.config.difficulty = e.target.value);
                document.getElementById('time-limit').addEventListener('change', (e) => this.config.timeLimit = parseInt(e.target.value));
                document.getElementById('target-size').addEventListener('change', (e) => this.config.targetSize = e.target.value);
                document.getElementById('spawn-rate').addEventListener('change', (e) => this.config.spawnRate = e.target.value);
                
                // Fullscreen controls
                document.getElementById('exit-fullscreen').addEventListener('click', () => this.exitFullscreen());
                document.getElementById('train-again').addEventListener('click', () => this.trainAgain());
                document.getElementById('back-to-trainer').addEventListener('click', () => this.backToTrainer());
                document.getElementById('view-leaderboard').addEventListener('click', () => this.scrollToLeaderboard());
                
                // Mode selection
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const mode = e.target.dataset.mode;
                        console.log('Mode button clicked:', mode);
                        if (mode === 'basic' || mode === 'dodge') {
                            this.selectedMode = mode;
                            console.log('Selected mode set to:', this.selectedMode);
                            this.highlightMode(mode);
                            this.updatePreview(mode);
                        }
                    });
                });
                
                // Fullscreen game area click
                this.fullscreenGameArea.addEventListener('click', (e) => this.handleFullscreenClick(e));
                
                // Leaderboard filters
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.filterLeaderboard(e.target.dataset.filter));
                });
                
                // Escape key to exit fullscreen
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.fullscreenMode) {
                        this.exitFullscreen();
                    }
                });
            }
            
            highlightMode(mode) {
                // Remover active de todas las cards y botones
                document.querySelectorAll('.trainer-mode').forEach(card => {
                    card.classList.remove('active-mode');
                });
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Activar la card correspondiente
                const activeCard = document.querySelector(`.trainer-mode[data-mode="${mode}"]`);
                if (activeCard) {
                    activeCard.classList.add('active-mode');
                }
                
                // Activar el botón correspondiente
                const activeBtn = document.querySelector(`.mode-btn[data-mode="${mode}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }
            }
            
            updatePreview(mode) {
                const titleEl = document.getElementById('preview-title');
                const descriptionEl = document.getElementById('preview-description');
                const featuresEl = document.getElementById('preview-features');
                const tipsEl = document.getElementById('micro-tips');
                
                // Mostrar/ocultar controles según el modo
                const basicControls = document.getElementById('basic-controls');
                const dodgeControls = document.getElementById('dodge-controls');
                
                if (mode === 'dodge') {
                    // Ocultar controles básicos y mostrar controles dodge
                    basicControls.style.display = 'none';
                    dodgeControls.style.display = 'block';
                    
                    titleEl.textContent = 'Control de Unidad - Modo Dodge';
                    descriptionEl.innerHTML = 'Controla una unidad esquivando proyectiles con <strong>click derecho</strong> como en AOE. El entrenamiento se ejecuta en <strong>pantalla completa</strong>.';
                    
                    featuresEl.innerHTML = `
                        <div class="preview-feature">
                            <span class="feature-icon">🖱️</span>
                            <span>Control con click derecho</span>
                        </div>
                        <div class="preview-feature">
                            <span class="feature-icon">💣</span>
                            <span>Proyectiles escalables</span>
                        </div>
                        <div class="preview-feature">
                            <span class="feature-icon">⚡</span>
                            <span>Entrenamiento de reflejos</span>
                        </div>
                        <div class="preview-feature">
                            <span class="feature-icon">📊</span>
                            <span>Tiempo de reacción</span>
                        </div>
                    `;
                    
                    tipsEl.innerHTML = `
                        <h5>💡 Tips de Control de Unidad:</h5>
                        <ul>
                            <li>🖱️ Click derecho para mover la unidad</li>
                            <li>👀 Predice trayectorias de proyectiles</li>
                            <li>⚡ Reacciona rápido pero no en pánico</li>
                            <li>🏃‍♂️ Usa todo el espacio disponible</li>
                            <li>🎯 Mantén distancia de los proyectiles</li>
                        </ul>
                    `;
                } else {
                    // Mostrar controles básicos y ocultar controles dodge
                    basicControls.style.display = 'block';
                    dodgeControls.style.display = 'none';
                    
                    // Modo básico
                    titleEl.textContent = 'Entrenamiento de Micromanagement AOE';
                    descriptionEl.innerHTML = 'El entrenamiento se ejecutará en <strong>pantalla completa</strong> para una experiencia inmersiva como un profesional de AOE.';
                    
                    featuresEl.innerHTML = `
                        <div class="preview-feature">
                            <span class="feature-icon">📊</span>
                            <span>HUD con estadísticas en tiempo real</span>
                        </div>
                        <div class="preview-feature">
                            <span class="feature-icon">🎯</span>
                            <span>Targets optimizados para micromanagement</span>
                        </div>
                        <div class="preview-feature">
                            <span class="feature-icon">⚡</span>
                            <span>Feedback visual inmediato</span>
                        </div>
                        <div class="preview-feature">
                            <span class="feature-icon">🏆</span>
                            <span>Sistema de ranking profesional</span>
                        </div>
                    `;
                    
                    tipsEl.innerHTML = `
                        <h5>💡 Tips de Micromanagement:</h5>
                        <ul>
                            <li>🖱️ Movimientos cortos y precisos</li>
                            <li>⚡ 3+ CPS para ranked competitivo</li>
                            <li>🎯 +80% precisión es esencial</li>
                            <li>🧘 Consistencia > velocidad pura</li>
                        </ul>
                    `;
                }
            }

            startDodgeTraining(duration) {
                this.isTraining = true;
                this.mode = 'dodge';
                this.selectedMode = 'dodge';
                this.stats = {
                    projectilesSpawned: 0,
                    projectilesDodged: 0,
                    hits: 0,
                    survivalTime: 0,
                    reactionTimes: [],
                    longestSurvivalStreak: 0,
                    averageReactionTime: 0
                };
                
                this.gameArea = document.getElementById('game-area');
                this.gameArea.innerHTML = '';
                this.gameArea.style.cursor = 'none';
                
                // Mostrar instrucciones iniciales
                this.showDodgeInstructions();
                
                // Crear la unidad del jugador
                this.createPlayerUnit();
                
                // Crear HUD para el modo dodge
                this.createDodgeHUD(duration);
                
                // Variables del modo dodge
                this.projectiles = [];
                this.playerUnit = {
                    x: this.gameArea.offsetWidth / 2,
                    y: this.gameArea.offsetHeight / 2,
                    size: 15,
                    speed: 8,
                    targetX: this.gameArea.offsetWidth / 2,
                    targetY: this.gameArea.offsetHeight / 2,
                    isMoving: false,
                    lastMoveTime: 0
                };
                
                this.dodgeSettings = {
                    projectileSpeed: 2,
                    spawnRate: 1500,
                    maxProjectiles: 5,
                    projectileSize: 8,
                    difficultyIncrease: 0.05
                };
                
                // Eventos de control
                this.setupDodgeControls();
                
                // Iniciar el juego
                this.dodgeStartTime = Date.now();
                this.dodgeGameLoop();
                this.spawnProjectiles();
                
                // Timer principal
                this.dodgeTimer = setTimeout(() => {
                    this.endDodgeTraining();
                }, duration * 1000);
            }

            createPlayerUnit() {
                const unit = document.createElement('div');
                unit.id = 'player-unit';
                unit.style.cssText = `
                    position: absolute;
                    width: 15px;
                    height: 15px;
                    background: radial-gradient(circle, #00ff88, #00cc66);
                    border: 2px solid #ffffff;
                    border-radius: 50%;
                    box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
                    z-index: 100;
                    transition: all 0.1s ease-out;
                `;
                this.gameArea.appendChild(unit);
                this.unitElement = unit;
            }

            showDodgeInstructions() {
                const instructions = document.createElement('div');
                instructions.id = 'dodge-instructions';
                instructions.style.cssText = `
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.9);
                    color: white;
                    padding: 30px;
                    border-radius: 15px;
                    text-align: center;
                    z-index: 300;
                    font-family: 'Arial', sans-serif;
                    max-width: 400px;
                `;
                instructions.innerHTML = `
                    <h3 style="color: #00ff88; margin-bottom: 20px;">🎯 Modo Dodge - Control de Unidad</h3>
                    <div style="margin-bottom: 15px;">
                        <div style="font-size: 16px; margin-bottom: 10px;">🖱️ <strong>Click derecho</strong> para mover tu unidad</div>
                        <div style="font-size: 16px; margin-bottom: 10px;">💣 Esquiva los proyectiles rojos</div>
                        <div style="font-size: 16px; margin-bottom: 10px;">⚡ Reacciona rápido y predice trayectorias</div>
                    </div>
                    <div style="font-size: 14px; color: #cccccc; margin-bottom: 20px;">
                        El entrenamiento comenzará en 3 segundos...
                    </div>
                    <div id="countdown" style="font-size: 24px; color: #00ff88; font-weight: bold;">3</div>
                `;
                this.gameArea.appendChild(instructions);

                // Countdown
                let count = 3;
                const countdownEl = document.getElementById('countdown');
                const countdownInterval = setInterval(() => {
                    count--;
                    if (count > 0) {
                        countdownEl.textContent = count;
                    } else {
                        countdownEl.textContent = '¡GO!';
                        setTimeout(() => {
                            instructions.remove();
                        }, 500);
                        clearInterval(countdownInterval);
                    }
                }, 1000);
            }

            createDodgeHUD(duration) {
                const hud = document.createElement('div');
                hud.id = 'dodge-hud';
                hud.style.cssText = `
                    position: absolute;
                    top: 20px;
                    left: 20px;
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 15px;
                    border-radius: 10px;
                    font-family: 'Courier New', monospace;
                    z-index: 200;
                    min-width: 200px;
                `;
                hud.innerHTML = `
                    <div style="color: #00ff88; font-weight: bold; margin-bottom: 10px;">🎯 DODGE MODE</div>
                    <div>⏱️ Tiempo: <span id="dodge-time">0s</span></div>
                    <div>💣 Proyectiles: <span id="projectiles-count">0</span></div>
                    <div>✅ Esquivados: <span id="dodged-count">0</span></div>
                    <div>❌ Impactos: <span id="hits-count-dodge">0</span></div>
                    <div>⚡ Reacción: <span id="reaction-time">0ms</span></div>
                    <div>🏆 Racha: <span id="survival-streak">0</span></div>
                `;
                this.gameArea.appendChild(hud);
            }

            setupDodgeControls() {
                this.gameArea.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    if (!this.isTraining) return;
                    
                    const rect = this.gameArea.getBoundingClientRect();
                    const newTargetX = e.clientX - rect.left;
                    const newTargetY = e.clientY - rect.top;
                    
                    // Registrar tiempo de reacción si hay proyectiles cerca
                    this.recordReactionTime(newTargetX, newTargetY);
                    
                    // Actualizar target de la unidad
                    this.playerUnit.targetX = Math.max(10, Math.min(this.gameArea.offsetWidth - 10, newTargetX));
                    this.playerUnit.targetY = Math.max(10, Math.min(this.gameArea.offsetHeight - 10, newTargetY));
                    this.playerUnit.isMoving = true;
                    this.playerUnit.lastMoveTime = Date.now();
                });
            }

            recordReactionTime(clickX, clickY) {
                const currentTime = Date.now();
                const dangerThreshold = 80;
                
                for (let projectile of this.projectiles) {
                    const distToProjectile = Math.sqrt(
                        Math.pow(projectile.x - this.playerUnit.x, 2) + 
                        Math.pow(projectile.y - this.playerUnit.y, 2)
                    );
                    
                    if (distToProjectile < dangerThreshold) {
                        const reactionTime = currentTime - projectile.spawnTime;
                        this.stats.reactionTimes.push(reactionTime);
                        
                        // Actualizar HUD
                        document.getElementById('reaction-time').textContent = `${reactionTime}ms`;
                        break;
                    }
                }
            }

            dodgeGameLoop() {
                if (!this.isTraining) return;
                
                // Actualizar posición de la unidad
                this.updatePlayerUnit();
                
                // Actualizar proyectiles
                this.updateProjectiles();
                
                // Verificar colisiones
                this.checkCollisions();
                
                // Actualizar HUD
                this.updateDodgeHUD();
                
                // Continuar el loop
                requestAnimationFrame(() => this.dodgeGameLoop());
            }

            updatePlayerUnit() {
                if (!this.playerUnit.isMoving) return;
                
                const dx = this.playerUnit.targetX - this.playerUnit.x;
                const dy = this.playerUnit.targetY - this.playerUnit.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 2) {
                    this.playerUnit.isMoving = false;
                    return;
                }
                
                const moveX = (dx / distance) * this.playerUnit.speed;
                const moveY = (dy / distance) * this.playerUnit.speed;
                
                this.playerUnit.x += moveX;
                this.playerUnit.y += moveY;
                
                // Actualizar posición visual
                this.unitElement.style.left = `${this.playerUnit.x - this.playerUnit.size/2}px`;
                this.unitElement.style.top = `${this.playerUnit.y - this.playerUnit.size/2}px`;
            }

            spawnProjectiles() {
                if (!this.isTraining) return;
                
                // Aumentar dificultad con el tiempo
                const elapsedTime = (Date.now() - this.dodgeStartTime) / 1000;
                const difficultyMultiplier = 1 + (elapsedTime * this.dodgeSettings.difficultyIncrease);
                
                if (this.projectiles.length < this.dodgeSettings.maxProjectiles * difficultyMultiplier) {
                    this.createProjectile();
                }
                
                // Programar siguiente spawn
                const nextSpawn = Math.max(300, this.dodgeSettings.spawnRate / difficultyMultiplier);
                setTimeout(() => this.spawnProjectiles(), nextSpawn);
            }

            createProjectile() {
                const side = Math.floor(Math.random() * 4); // 0: top, 1: right, 2: bottom, 3: left
                let x, y, targetX, targetY;
                
                // Posición inicial del proyectil desde los bordes
                switch(side) {
                    case 0: // top
                        x = Math.random() * this.gameArea.offsetWidth;
                        y = -20;
                        break;
                    case 1: // right
                        x = this.gameArea.offsetWidth + 20;
                        y = Math.random() * this.gameArea.offsetHeight;
                        break;
                    case 2: // bottom
                        x = Math.random() * this.gameArea.offsetWidth;
                        y = this.gameArea.offsetHeight + 20;
                        break;
                    case 3: // left
                        x = -20;
                        y = Math.random() * this.gameArea.offsetHeight;
                        break;
                }
                
                // Target: posición actual del jugador con predicción
                targetX = this.playerUnit.x + (Math.random() - 0.5) * 100;
                targetY = this.playerUnit.y + (Math.random() - 0.5) * 100;
                
                const projectile = {
                    x: x,
                    y: y,
                    targetX: targetX,
                    targetY: targetY,
                    speed: this.dodgeSettings.projectileSpeed,
                    size: this.dodgeSettings.projectileSize,
                    spawnTime: Date.now(),
                    element: null
                };
                
                // Crear elemento visual
                const element = document.createElement('div');
                element.className = 'projectile projectile-spawn';
                element.style.cssText = `
                    position: absolute;
                    width: ${projectile.size}px;
                    height: ${projectile.size}px;
                    background: radial-gradient(circle, #ff4444, #cc0000);
                    border: 1px solid #ffffff;
                    border-radius: 50%;
                    box-shadow: 0 0 8px rgba(255, 68, 68, 0.6);
                    z-index: 50;
                `;
                
                projectile.element = element;
                this.gameArea.appendChild(element);
                this.projectiles.push(projectile);
                this.stats.projectilesSpawned++;
                
                // Remover clase de animación después de la animación
                setTimeout(() => {
                    element.classList.remove('projectile-spawn');
                }, 300);
            }

            updateProjectiles() {
                for (let i = this.projectiles.length - 1; i >= 0; i--) {
                    const projectile = this.projectiles[i];
                    
                    // Calcular dirección hacia el target
                    const dx = projectile.targetX - projectile.x;
                    const dy = projectile.targetY - projectile.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 5) {
                        // Proyectil llegó a su destino
                        this.removeProjectile(i);
                        this.stats.projectilesDodged++;
                        continue;
                    }
                    
                    // Mover proyectil
                    const moveX = (dx / distance) * projectile.speed;
                    const moveY = (dy / distance) * projectile.speed;
                    
                    projectile.x += moveX;
                    projectile.y += moveY;
                    
                    // Actualizar posición visual
                    projectile.element.style.left = `${projectile.x - projectile.size/2}px`;
                    projectile.element.style.top = `${projectile.y - projectile.size/2}px`;
                    
                    // Remover si sale de los límites
                    if (projectile.x < -50 || projectile.x > this.gameArea.offsetWidth + 50 ||
                        projectile.y < -50 || projectile.y > this.gameArea.offsetHeight + 50) {
                        this.removeProjectile(i);
                        this.stats.projectilesDodged++;
                    }
                }
            }

            checkCollisions() {
                for (let i = this.projectiles.length - 1; i >= 0; i--) {
                    const projectile = this.projectiles[i];
                    const distance = Math.sqrt(
                        Math.pow(projectile.x - this.playerUnit.x, 2) + 
                        Math.pow(projectile.y - this.playerUnit.y, 2)
                    );
                    
                    if (distance < (projectile.size + this.playerUnit.size) / 2) {
                        // Colisión detectada
                        this.handleHit();
                        this.removeProjectile(i);
                    }
                }
            }

            handleHit() {
                this.stats.hits++;
                this.stats.longestSurvivalStreak = 0;
                
                // Efecto visual de impacto
                this.unitElement.style.boxShadow = '0 0 20px rgba(255, 0, 0, 0.8)';
                this.unitElement.style.background = 'radial-gradient(circle, #ff4444, #cc0000)';
                
                setTimeout(() => {
                    if (this.unitElement) {
                        this.unitElement.style.boxShadow = '0 0 10px rgba(0, 255, 136, 0.5)';
                        this.unitElement.style.background = 'radial-gradient(circle, #00ff88, #00cc66)';
                    }
                }, 200);
            }

            removeProjectile(index) {
                const projectile = this.projectiles[index];
                if (projectile.element && projectile.element.parentNode) {
                    projectile.element.parentNode.removeChild(projectile.element);
                }
                this.projectiles.splice(index, 1);
            }

            updateDodgeHUD() {
                const elapsedTime = Math.floor((Date.now() - this.dodgeStartTime) / 1000);
                const avgReaction = this.stats.reactionTimes.length > 0 
                    ? Math.round(this.stats.reactionTimes.reduce((a, b) => a + b, 0) / this.stats.reactionTimes.length)
                    : 0;
                
                document.getElementById('dodge-time').textContent = `${elapsedTime}s`;
                document.getElementById('projectiles-count').textContent = this.stats.projectilesSpawned;
                document.getElementById('dodged-count').textContent = this.stats.projectilesDodged;
                document.getElementById('hits-count-dodge').textContent = this.stats.hits;
                document.getElementById('survival-streak').textContent = this.stats.projectilesDodged;
                
                this.stats.survivalTime = elapsedTime;
                this.stats.averageReactionTime = avgReaction;
            }

            endDodgeTraining() {
                this.isTraining = false;
                
                // Limpiar timers
                if (this.dodgeTimer) {
                    clearTimeout(this.dodgeTimer);
                    this.dodgeTimer = null;
                }
                
                // Limpiar proyectiles
                this.projectiles.forEach(projectile => {
                    if (projectile.element && projectile.element.parentNode) {
                        projectile.element.parentNode.removeChild(projectile.element);
                    }
                });
                this.projectiles = [];
                
                // Mostrar resultados
                this.showDodgeResults();
            }

            showDodgeResults() {
                const accuracy = this.stats.projectilesSpawned > 0 
                    ? ((this.stats.projectilesDodged / this.stats.projectilesSpawned) * 100).toFixed(1)
                    : 0;
                
                const survivalRate = this.stats.hits === 0 ? 100 : 
                    ((this.stats.survivalTime / (this.stats.survivalTime + this.stats.hits)) * 100).toFixed(1);
                
                let rating = 'Principiante 🔰';
                if (accuracy >= 90 && this.stats.averageReactionTime < 500) rating = 'Maestro 🏆';
                else if (accuracy >= 80 && this.stats.averageReactionTime < 700) rating = 'Experto ⭐';
                else if (accuracy >= 70 && this.stats.averageReactionTime < 900) rating = 'Avanzado 💪';
                else if (accuracy >= 60) rating = 'Intermedio 📈';
                
                const resultsHTML = `
                    <div class="results-header">
                        <h2>🎯 Resultados del Entrenamiento Dodge</h2>
                        <div class="rating">${rating}</div>
                    </div>
                    <div class="results-grid">
                        <div class="result-card">
                            <div class="result-value">${this.stats.survivalTime}s</div>
                            <div class="result-label">Tiempo de Supervivencia</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value">${accuracy}%</div>
                            <div class="result-label">Evasión</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value">${this.stats.averageReactionTime}ms</div>
                            <div class="result-label">Reacción Promedio</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value">${this.stats.hits}</div>
                            <div class="result-label">Impactos Recibidos</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value">${this.stats.projectilesDodged}</div>
                            <div class="result-label">Proyectiles Esquivados</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value">${survivalRate}%</div>
                            <div class="result-label">Tasa de Supervivencia</div>
                        </div>
                    </div>
                    <div class="results-analysis">
                        <h3>📊 Análisis de Rendimiento</h3>
                        <div class="analysis-section">
                            <strong>🎯 Control de Unidad:</strong>
                            ${accuracy >= 80 ? 
                                '<span class="good">Excelente micromanagement, tus movimientos son precisos y eficientes.</span>' :
                                accuracy >= 60 ?
                                '<span class="average">Buen control, pero puedes mejorar la predicción de proyectiles.</span>' :
                                '<span class="poor">Necesitas practicar más el control de unidad y anticipación.</span>'
                            }
                        </div>
                        <div class="analysis-section">
                            <strong>⚡ Tiempo de Reacción:</strong>
                            ${this.stats.averageReactionTime < 500 ? 
                                '<span class="good">Reflejos de pro-player! Tu tiempo de reacción es excelente.</span>' :
                                this.stats.averageReactionTime < 800 ?
                                '<span class="average">Buenos reflejos, pero puedes ser más rápido en situaciones de peligro.</span>' :
                                '<span class="poor">Trabaja en reducir tu tiempo de reacción con más práctica.</span>'
                            }
                        </div>
                        <div class="analysis-section">
                            <strong>🏆 Supervivencia:</strong>
                            ${this.stats.hits === 0 ? 
                                '<span class="good">¡Supervivencia perfecta! No recibiste ningún impacto.</span>' :
                                this.stats.hits <= 2 ?
                                '<span class="average">Buena supervivencia con pocos impactos recibidos.</span>' :
                                '<span class="poor">Recibiste muchos impactos, mejora tu posicionamiento y predicción.</span>'
                            }
                        </div>
                    </div>
                    <div class="results-actions">
                        <button onclick="trainer.startDodgeFullscreen()" class="primary-button">🔄 Entrenar de Nuevo</button>
                        <button onclick="trainer.resetTrainer()" class="secondary-button">🏠 Volver al Menú</button>
                    </div>
                `;
                
                this.showResults(resultsHTML);
            }
            
            startDodgeFullscreen() {
                console.log('=== startDodgeFullscreen called ===');
                console.log('fullscreenContainer:', this.fullscreenContainer);
                console.log('fullscreenGameArea:', this.fullscreenGameArea);
                
                this.gameActive = true;
                this.fullscreenMode = true;
                this.mode = 'dodge';
                
                // Obtener configuración específica del modo dodge
                const dodgeConfig = this.getDodgeConfig();
                console.log('Dodge config:', dodgeConfig);
                
                this.stats = {
                    projectilesSpawned: 0,
                    projectilesDodged: 0,
                    hits: 0,
                    survivalTime: 0,
                    reactionTimes: [],
                    longestSurvivalStreak: 0,
                    averageReactionTime: 0,
                    startTime: Date.now(),
                    timeLimit: dodgeConfig.timeLimit
                };
                
                console.log('About to show fullscreen container...');
                
                // Enter fullscreen mode
                if (this.fullscreenContainer) {
                    this.fullscreenContainer.style.display = 'block';
                    console.log('Fullscreen container displayed');
                } else {
                    console.error('fullscreenContainer is null!');
                    return;
                }
                
                document.body.style.overflow = 'hidden';
                
                // Hide main interface
                const mainEl = document.querySelector('main');
                const heroEl = document.querySelector('.hero');
                
                if (mainEl) {
                    mainEl.style.display = 'none';
                    console.log('Main hidden');
                } else {
                    console.log('Main element not found');
                }
                
                if (heroEl) {
                    heroEl.style.display = 'none';
                    console.log('Hero hidden');
                } else {
                    console.log('Hero element not found');
                }
                
                // Hide regular results
                const resultsSection = document.getElementById('results-section');
                if (resultsSection) {
                    resultsSection.style.display = 'none';
                    console.log('Results section hidden');
                } else {
                    console.log('Results section not found');
                }
                
                console.log('Setting up dodge fullscreen...');
                
                // Configurar el área de juego para dodge
                this.setupDodgeFullscreen(dodgeConfig);
                
                console.log('Starting dodge game systems...');
                
                // Start dodge training
                this.startDodgeGameLoop();
                this.spawnProjectilesFullscreen();
                
                // Timer principal
                this.dodgeTimer = setTimeout(() => {
                    this.endDodgeFullscreen();
                }, dodgeConfig.timeLimit * 1000);
                
                console.log('=== startDodgeFullscreen completed ===');
            }

            getDodgeConfig() {
                const difficulty = document.getElementById('dodge-difficulty')?.value || 'normal';
                const timeLimit = parseInt(document.getElementById('dodge-time-limit')?.value || '60');
                const unitSpeed = document.getElementById('unit-speed')?.value || 'normal';
                const maxProjectiles = parseInt(document.getElementById('projectile-count')?.value || '5');
                
                const difficultySettings = {
                    easy: { projectileSpeed: 1.5, spawnRate: 2000, difficultyIncrease: 0.02 },
                    normal: { projectileSpeed: 2, spawnRate: 1500, difficultyIncrease: 0.05 },
                    hard: { projectileSpeed: 3, spawnRate: 1000, difficultyIncrease: 0.08 },
                    extreme: { projectileSpeed: 4, spawnRate: 800, difficultyIncrease: 0.1 },
                    nightmare: { projectileSpeed: 5, spawnRate: 600, difficultyIncrease: 0.15 }
                };
                
                const speedSettings = {
                    slow: 6,
                    normal: 8,
                    fast: 12,
                    lightning: 16
                };
                
                return {
                    timeLimit: timeLimit,
                    maxProjectiles: maxProjectiles,
                    unitSpeed: speedSettings[unitSpeed],
                    ...difficultySettings[difficulty]
                };
            }

            setupDodgeFullscreen(config) {
                // Limpiar el área de juego fullscreen
                this.fullscreenGameArea.innerHTML = '';
                this.fullscreenGameArea.style.cursor = 'crosshair';
                
                // Variables del modo dodge  
                this.projectiles = [];
                this.playerUnit = {
                    x: this.fullscreenGameArea.offsetWidth / 2,
                    y: this.fullscreenGameArea.offsetHeight / 2,
                    size: 15,
                    speed: config.unitSpeed,
                    targetX: this.fullscreenGameArea.offsetWidth / 2,
                    targetY: this.fullscreenGameArea.offsetHeight / 2,
                    isMoving: false,
                    lastMoveTime: 0
                };
                
                this.dodgeSettings = {
                    projectileSpeed: config.projectileSpeed,
                    spawnRate: config.spawnRate,
                    maxProjectiles: config.maxProjectiles,
                    projectileSize: 8,
                    difficultyIncrease: config.difficultyIncrease
                };
                
                // Crear la unidad del jugador en fullscreen
                this.createPlayerUnitFullscreen();
                
                // Crear HUD para el modo dodge en fullscreen
                this.createDodgeHUDFullscreen(config.timeLimit);
                
                // Setup controles para fullscreen
                this.setupDodgeControlsFullscreen();
                
                // Inicializar tiempo de inicio
                this.dodgeStartTime = Date.now();
            }

            createPlayerUnitFullscreen() {
                const unit = document.createElement('div');
                unit.id = 'player-unit-fullscreen';
                unit.style.cssText = `
                    position: absolute;
                    width: 15px;
                    height: 15px;
                    background: radial-gradient(circle, #00ff88, #00cc66);
                    border: 2px solid #ffffff;
                    border-radius: 50%;
                    box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
                    z-index: 100;
                    transition: all 0.1s ease-out;
                `;
                this.fullscreenGameArea.appendChild(unit);
                this.unitElement = unit;
            }

            createDodgeHUDFullscreen(timeLimit) {
                const hud = document.createElement('div');
                hud.id = 'dodge-hud-fullscreen';
                hud.style.cssText = `
                    position: absolute;
                    top: 20px;
                    left: 20px;
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 15px;
                    border-radius: 10px;
                    font-family: 'Courier New', monospace;
                    z-index: 200;
                    min-width: 200px;
                    font-size: 14px;
                `;
                hud.innerHTML = `
                    <div style="color: #00ff88; font-weight: bold; margin-bottom: 10px;">🎯 DODGE MODE - FULLSCREEN</div>
                    <div>⏱️ Tiempo: <span id="dodge-time-fs">0s</span> / <span id="dodge-total-time">${timeLimit}s</span></div>
                    <div>💣 Proyectiles: <span id="projectiles-count-fs">0</span></div>
                    <div>✅ Esquivados: <span id="dodged-count-fs">0</span></div>
                    <div>❌ Impactos: <span id="hits-count-dodge-fs">0</span></div>
                    <div>⚡ Reacción: <span id="reaction-time-fs">0ms</span></div>
                    <div>🏆 Racha: <span id="survival-streak-fs">0</span></div>
                `;
                this.fullscreenGameArea.appendChild(hud);
            }

            setupDodgeControlsFullscreen() {
                this.fullscreenGameArea.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    if (!this.gameActive) return;
                    
                    const rect = this.fullscreenGameArea.getBoundingClientRect();
                    const newTargetX = e.clientX - rect.left;
                    const newTargetY = e.clientY - rect.top;
                    
                    // Mostrar feedback visual del click
                    this.showClickFeedback(newTargetX, newTargetY);
                    
                    // Registrar tiempo de reacción si hay proyectiles cerca
                    this.recordReactionTimeFullscreen(newTargetX, newTargetY);
                    
                    // Actualizar target de la unidad
                    this.playerUnit.targetX = Math.max(10, Math.min(this.fullscreenGameArea.offsetWidth - 10, newTargetX));
                    this.playerUnit.targetY = Math.max(10, Math.min(this.fullscreenGameArea.offsetHeight - 10, newTargetY));
                    this.playerUnit.isMoving = true;
                    this.playerUnit.lastMoveTime = Date.now();
                });
            }

            showClickFeedback(x, y) {
                // Crear indicador visual del click
                const clickIndicator = document.createElement('div');
                clickIndicator.style.cssText = `
                    position: absolute;
                    left: ${x - 10}px;
                    top: ${y - 10}px;
                    width: 20px;
                    height: 20px;
                    border: 2px solid #00ff88;
                    border-radius: 50%;
                    pointer-events: none;
                    z-index: 1000;
                    animation: clickPulse 0.6s ease-out forwards;
                `;
                
                this.fullscreenGameArea.appendChild(clickIndicator);
                
                // Remover el indicador después de la animación
                setTimeout(() => {
                    if (clickIndicator.parentNode) {
                        clickIndicator.parentNode.removeChild(clickIndicator);
                    }
                }, 600);
            }

            recordReactionTimeFullscreen(clickX, clickY) {
                const currentTime = Date.now();
                const dangerThreshold = 80;
                
                for (let projectile of this.projectiles) {
                    const distToProjectile = Math.sqrt(
                        Math.pow(projectile.x - this.playerUnit.x, 2) + 
                        Math.pow(projectile.y - this.playerUnit.y, 2)
                    );
                    
                    if (distToProjectile < dangerThreshold) {
                        const reactionTime = currentTime - projectile.spawnTime;
                        this.stats.reactionTimes.push(reactionTime);
                        
                        // Actualizar HUD fullscreen
                        document.getElementById('reaction-time-fs').textContent = `${reactionTime}ms`;
                        break;
                    }
                }
            }

            startDodgeGameLoop() {
                if (!this.gameActive) return;
                
                // Actualizar posición de la unidad
                this.updatePlayerUnitFullscreen();
                
                // Actualizar proyectiles
                this.updateProjectilesFullscreen();
                
                // Verificar colisiones
                this.checkCollisionsFullscreen();
                
                // Actualizar HUD
                this.updateDodgeHUDFullscreen();
                
                // Continuar el loop
                requestAnimationFrame(() => this.startDodgeGameLoop());
            }

            updatePlayerUnitFullscreen() {
                if (!this.playerUnit.isMoving) {
                    // Remover línea de movimiento si existe
                    this.removeMovementLine();
                    return;
                }
                
                const dx = this.playerUnit.targetX - this.playerUnit.x;
                const dy = this.playerUnit.targetY - this.playerUnit.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 2) {
                    this.playerUnit.isMoving = false;
                    this.removeMovementLine();
                    return;
                }
                
                // Mostrar línea hacia el destino
                this.showMovementLine();
                
                const moveX = (dx / distance) * this.playerUnit.speed;
                const moveY = (dy / distance) * this.playerUnit.speed;
                
                this.playerUnit.x += moveX;
                this.playerUnit.y += moveY;
                
                // Actualizar posición visual
                this.unitElement.style.left = `${this.playerUnit.x - this.playerUnit.size/2}px`;
                this.unitElement.style.top = `${this.playerUnit.y - this.playerUnit.size/2}px`;
            }

            showMovementLine() {
                // Remover línea anterior si existe
                this.removeMovementLine();
                
                // Crear nueva línea de movimiento
                const line = document.createElement('div');
                line.id = 'movement-line';
                
                const dx = this.playerUnit.targetX - this.playerUnit.x;
                const dy = this.playerUnit.targetY - this.playerUnit.y;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                
                line.style.cssText = `
                    position: absolute;
                    left: ${this.playerUnit.x}px;
                    top: ${this.playerUnit.y}px;
                    width: ${length}px;
                    height: 2px;
                    background: linear-gradient(to right, 
                        rgba(0, 255, 136, 0.8) 0%, 
                        rgba(0, 255, 136, 0.4) 70%, 
                        rgba(0, 255, 136, 0.1) 100%);
                    transform-origin: 0 50%;
                    transform: rotate(${angle}deg);
                    pointer-events: none;
                    z-index: 75;
                `;
                
                this.fullscreenGameArea.appendChild(line);
            }

            removeMovementLine() {
                const existingLine = document.getElementById('movement-line');
                if (existingLine && existingLine.parentNode) {
                    existingLine.parentNode.removeChild(existingLine);
                }
            }

            spawnProjectilesFullscreen() {
                if (!this.gameActive) return;
                
                // Aumentar dificultad con el tiempo
                const elapsedTime = (Date.now() - this.dodgeStartTime) / 1000;
                const difficultyMultiplier = 1 + (elapsedTime * this.dodgeSettings.difficultyIncrease);
                
                if (this.projectiles.length < this.dodgeSettings.maxProjectiles * difficultyMultiplier) {
                    this.createProjectileFullscreen();
                }
                
                // Programar siguiente spawn
                const nextSpawn = Math.max(300, this.dodgeSettings.spawnRate / difficultyMultiplier);
                setTimeout(() => this.spawnProjectilesFullscreen(), nextSpawn);
            }

            createProjectileFullscreen() {
                const side = Math.floor(Math.random() * 4); // 0: top, 1: right, 2: bottom, 3: left
                let x, y, targetX, targetY;
                
                // Posición inicial del proyectil desde los bordes
                switch(side) {
                    case 0: // top
                        x = Math.random() * this.fullscreenGameArea.offsetWidth;
                        y = -20;
                        break;
                    case 1: // right
                        x = this.fullscreenGameArea.offsetWidth + 20;
                        y = Math.random() * this.fullscreenGameArea.offsetHeight;
                        break;
                    case 2: // bottom
                        x = Math.random() * this.fullscreenGameArea.offsetWidth;
                        y = this.fullscreenGameArea.offsetHeight + 20;
                        break;
                    case 3: // left
                        x = -20;
                        y = Math.random() * this.fullscreenGameArea.offsetHeight;
                        break;
                }
                
                // Target: posición actual del jugador con predicción
                targetX = this.playerUnit.x + (Math.random() - 0.5) * 100;
                targetY = this.playerUnit.y + (Math.random() - 0.5) * 100;
                
                const projectile = {
                    x: x,
                    y: y,
                    targetX: targetX,
                    targetY: targetY,
                    speed: this.dodgeSettings.projectileSpeed,
                    size: this.dodgeSettings.projectileSize,
                    spawnTime: Date.now(),
                    element: null
                };
                
                // Crear elemento visual
                const element = document.createElement('div');
                element.className = 'projectile projectile-spawn';
                element.style.cssText = `
                    position: absolute;
                    width: ${projectile.size}px;
                    height: ${projectile.size}px;
                    background: radial-gradient(circle, #ff4444, #cc0000);
                    border: 1px solid #ffffff;
                    border-radius: 50%;
                    box-shadow: 0 0 8px rgba(255, 68, 68, 0.6);
                    z-index: 50;
                `;
                
                projectile.element = element;
                this.fullscreenGameArea.appendChild(element);
                this.projectiles.push(projectile);
                this.stats.projectilesSpawned++;
                
                // Remover clase de animación después de la animación
                setTimeout(() => {
                    element.classList.remove('projectile-spawn');
                }, 300);
            }

            updateProjectilesFullscreen() {
                for (let i = this.projectiles.length - 1; i >= 0; i--) {
                    const projectile = this.projectiles[i];
                    
                    // Calcular dirección hacia el target
                    const dx = projectile.targetX - projectile.x;
                    const dy = projectile.targetY - projectile.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 5) {
                        // Proyectil llegó a su destino
                        this.removeProjectileFullscreen(i);
                        this.stats.projectilesDodged++;
                        continue;
                    }
                    
                    // Mover proyectil
                    const moveX = (dx / distance) * projectile.speed;
                    const moveY = (dy / distance) * projectile.speed;
                    
                    projectile.x += moveX;
                    projectile.y += moveY;
                    
                    // Actualizar posición visual
                    projectile.element.style.left = `${projectile.x - projectile.size/2}px`;
                    projectile.element.style.top = `${projectile.y - projectile.size/2}px`;
                    
                    // Remover si sale de los límites
                    if (projectile.x < -50 || projectile.x > this.fullscreenGameArea.offsetWidth + 50 ||
                        projectile.y < -50 || projectile.y > this.fullscreenGameArea.offsetHeight + 50) {
                        this.removeProjectileFullscreen(i);
                        this.stats.projectilesDodged++;
                    }
                }
            }

            checkCollisionsFullscreen() {
                for (let i = this.projectiles.length - 1; i >= 0; i--) {
                    const projectile = this.projectiles[i];
                    const distance = Math.sqrt(
                        Math.pow(projectile.x - this.playerUnit.x, 2) + 
                        Math.pow(projectile.y - this.playerUnit.y, 2)
                    );
                    
                    if (distance < (projectile.size + this.playerUnit.size) / 2 + 2) {
                        // Colisión detectada
                        this.handleHitFullscreen();
                        this.removeProjectileFullscreen(i);
                    }
                }
            }

            handleHitFullscreen() {
                this.stats.hits++;
                this.stats.longestSurvivalStreak = 0;
                
                // Efecto visual de impacto
                this.unitElement.style.boxShadow = '0 0 20px rgba(255, 0, 0, 0.8)';
                this.unitElement.style.background = 'radial-gradient(circle, #ff4444, #cc0000)';
                
                setTimeout(() => {
                    if (this.unitElement) {
                        this.unitElement.style.boxShadow = '0 0 10px rgba(0, 255, 136, 0.5)';
                        this.unitElement.style.background = 'radial-gradient(circle, #00ff88, #00cc66)';
                    }
                }, 200);
            }

            removeProjectileFullscreen(index) {
                const projectile = this.projectiles[index];
                if (projectile.element && projectile.element.parentNode) {
                    projectile.element.parentNode.removeChild(projectile.element);
                }
                this.projectiles.splice(index, 1);
            }

            updateDodgeHUDFullscreen() {
                const elapsedTime = Math.floor((Date.now() - this.dodgeStartTime) / 1000);
                const avgReaction = this.stats.reactionTimes.length > 0 
                    ? Math.round(this.stats.reactionTimes.reduce((a, b) => a + b, 0) / this.stats.reactionTimes.length)
                    : 0;
                
                document.getElementById('dodge-time-fs').textContent = `${elapsedTime}s`;
                document.getElementById('projectiles-count-fs').textContent = this.stats.projectilesSpawned;
                document.getElementById('dodged-count-fs').textContent = this.stats.projectilesDodged;
                document.getElementById('hits-count-dodge-fs').textContent = this.stats.hits;
                document.getElementById('survival-streak-fs').textContent = this.stats.projectilesDodged;
                
                this.stats.survivalTime = elapsedTime;
                this.stats.averageReactionTime = avgReaction;
            }

            endDodgeFullscreen() {
                this.gameActive = false;
                
                // Limpiar timers
                if (this.dodgeTimer) {
                    clearTimeout(this.dodgeTimer);
                    this.dodgeTimer = null;
                }
                
                // Limpiar línea de movimiento
                this.removeMovementLine();
                
                // Limpiar proyectiles
                this.projectiles.forEach(projectile => {
                    if (projectile.element && projectile.element.parentNode) {
                        projectile.element.parentNode.removeChild(projectile.element);
                    }
                });
                this.projectiles = [];
                
                // Mostrar resultados en fullscreen
                this.showDodgeResultsFullscreen();
            }

            showDodgeResultsFullscreen() {
                const accuracy = this.stats.projectilesSpawned > 0 
                    ? ((this.stats.projectilesDodged / this.stats.projectilesSpawned) * 100).toFixed(1)
                    : 0;
                
                const survivalRate = this.stats.hits === 0 ? 100 : 
                    ((this.stats.survivalTime / (this.stats.survivalTime + this.stats.hits)) * 100).toFixed(1);
                
                let rating = 'Principiante 🔰';
                if (accuracy >= 90 && this.stats.averageReactionTime < 500) rating = 'Maestro 🏆';
                else if (accuracy >= 80 && this.stats.averageReactionTime < 700) rating = 'Experto ⭐';
                else if (accuracy >= 70 && this.stats.averageReactionTime < 900) rating = 'Avanzado 💪';
                else if (accuracy >= 60) rating = 'Intermedio 📈';
                
                const resultsHTML = `
                    <div class="fullscreen-results-header">
                        <h1>🎯 Resultados del Entrenamiento Dodge</h1>
                        <div class="rating-badge">${rating}</div>
                    </div>
                    <div class="fullscreen-results-grid">
                        <div class="result-card-fullscreen">
                            <div class="result-value">${this.stats.survivalTime}s</div>
                            <div class="result-label">Tiempo de Supervivencia</div>
                        </div>
                        <div class="result-card-fullscreen">
                            <div class="result-value">${accuracy}%</div>
                            <div class="result-label">Evasión</div>
                        </div>
                        <div class="result-card-fullscreen">
                            <div class="result-value">${this.stats.averageReactionTime}ms</div>
                            <div class="result-label">Reacción Promedio</div>
                        </div>
                        <div class="result-card-fullscreen">
                            <div class="result-value">${this.stats.hits}</div>
                            <div class="result-label">Impactos Recibidos</div>
                        </div>
                        <div class="result-card-fullscreen">
                            <div class="result-value">${this.stats.projectilesDodged}</div>
                            <div class="result-label">Proyectiles Esquivados</div>
                        </div>
                        <div class="result-card-fullscreen">
                            <div class="result-value">${survivalRate}%</div>
                            <div class="result-label">Tasa de Supervivencia</div>
                        </div>
                    </div>
                    <div class="fullscreen-results-actions">
                        <button onclick="trainer.trainAgainDodge()" class="btn-fullscreen primary">🔄 Entrenar de Nuevo</button>
                        <button onclick="trainer.backToTrainer()" class="btn-fullscreen secondary">🏠 Volver al Menú</button>
                    </div>
                `;
                
                this.resultsOverlay.innerHTML = resultsHTML;
                this.resultsOverlay.style.display = 'flex';
            }

            trainAgainDodge() {
                this.resultsOverlay.style.display = 'none';
                this.startDodgeFullscreen();
            }
            
            startFullscreenGame() {
                console.log('=== startFullscreenGame called ===');
                console.log('fullscreenContainer:', this.fullscreenContainer);
                console.log('fullscreenGameArea:', this.fullscreenGameArea);
                
                this.gameActive = true;
                this.fullscreenMode = true;
                this.stats = {
                    clicks: 0,
                    hits: 0,
                    misses: 0,
                    startTime: Date.now(),
                    timeLimit: this.config.timeLimit,
                    cpsHistory: []
                };
                
                console.log('About to show fullscreen container...');
                
                // Enter fullscreen mode
                if (this.fullscreenContainer) {
                    this.fullscreenContainer.style.display = 'block';
                    console.log('Fullscreen container displayed');
                } else {
                    console.error('fullscreenContainer is null!');
                    return;
                }
                
                document.body.style.overflow = 'hidden';
                
                console.log('About to hide main elements...');
                
                // Hide main interface
                const mainEl = document.querySelector('main');
                const heroEl = document.querySelector('.hero');
                
                if (mainEl) {
                    mainEl.style.display = 'none';
                    console.log('Main hidden');
                } else {
                    console.log('Main element not found');
                }
                
                if (heroEl) {
                    heroEl.style.display = 'none';
                    console.log('Hero hidden');
                } else {
                    console.log('Hero element not found');
                }
                
                // Hide regular results
                const resultsSection = document.getElementById('results-section');
                if (resultsSection) {
                    resultsSection.style.display = 'none';
                    console.log('Results section hidden');
                } else {
                    console.log('Results section not found');
                }
                
                console.log('Starting game systems...');
                
                // Start game systems
                this.startTimer();
                this.startCPSTracking();
                this.generateTargets();
                this.updateFullscreenStats();
                
                console.log('=== startFullscreenGame completed ===');
            }
            
            resetGame() {
                this.endGame(true);
            }
            
            exitFullscreen() {
                if (this.gameActive) {
                    this.endGame(true);
                } else {
                    this.backToTrainer();
                }
            }
            
            trainAgain() {
                this.resultsOverlay.style.display = 'none';
                this.startFullscreenGame();
            }
            
            backToTrainer() {
                this.fullscreenContainer.style.display = 'none';
                this.resultsOverlay.style.display = 'none';
                document.body.style.overflow = 'auto';
                this.fullscreenMode = false;
                
                // Show main interface again
                document.querySelector('main').style.display = 'block';
                document.querySelector('.hero').style.display = 'block';
                
                // Reset buttons
                document.getElementById('start-trainer').style.display = 'inline-block';
                document.getElementById('reset-trainer').style.display = 'none';
            }

            resetTrainer() {
                // Detener cualquier entrenamiento activo
                this.isTraining = false;
                
                // Limpiar timers del modo dodge
                if (this.dodgeTimer) {
                    clearTimeout(this.dodgeTimer);
                    this.dodgeTimer = null;
                }
                
                // Limpiar proyectiles
                if (this.projectiles) {
                    this.projectiles.forEach(projectile => {
                        if (projectile.element && projectile.element.parentNode) {
                            projectile.element.parentNode.removeChild(projectile.element);
                        }
                    });
                    this.projectiles = [];
                }
                
                // Limpiar área de juego
                const gameArea = document.getElementById('game-area');
                gameArea.innerHTML = '';
                gameArea.style.cursor = 'default';
                
                // Ocultar overlay de resultados si está visible
                if (this.resultsOverlay) {
                    this.resultsOverlay.style.display = 'none';
                }
                
                // Volver al modo básico
                this.selectedMode = 'basic';
                this.highlightMode('basic');
                this.updatePreview('basic');
                
                // Resetear configuración predeterminada
                this.config = {
                    difficulty: 'intermediate',
                    timeLimit: 60,
                    targetSize: 'medium',
                    spawnRate: 'normal'
                };
                
                // Actualizar controles
                document.getElementById('difficulty').value = this.config.difficulty;
                document.getElementById('time-limit').value = this.config.timeLimit;
                document.getElementById('target-size').value = this.config.targetSize;
                document.getElementById('spawn-rate').value = this.config.spawnRate;
            }
            
            scrollToLeaderboard() {
                this.backToTrainer();
                // Smooth scroll to leaderboard section
                setTimeout(() => {
                    const leaderboardSection = document.querySelector('.leaderboard-section');
                    if (leaderboardSection) {
                        leaderboardSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 100);
            }
            
            startTimer() {
                let timeRemaining = this.config.timeLimit;
                const totalTime = this.config.timeLimit;
                
                // Update both displays
                document.getElementById('time-remaining').textContent = timeRemaining;
                document.getElementById('fs-time').textContent = timeRemaining;
                
                this.timer = setInterval(() => {
                    timeRemaining--;
                    document.getElementById('time-remaining').textContent = timeRemaining;
                    document.getElementById('fs-time').textContent = timeRemaining;
                    
                    // Update progress bar
                    const progress = ((totalTime - timeRemaining) / totalTime) * 100;
                    document.getElementById('time-progress').style.width = progress + '%';
                    document.getElementById('fs-progress').style.width = progress + '%';
                    
                    // Change color when time is running out
                    if (timeRemaining <= 10) {
                        document.getElementById('fs-time').style.color = '#f44336';
                        document.getElementById('fs-time').style.textShadow = '0 0 20px rgba(244, 67, 54, 0.8)';
                    }
                    
                    if (timeRemaining <= 0) {
                        this.endGame();
                    }
                }, 1000);
            }
            
            startCPSTracking() {
                this.cpsInterval = setInterval(() => {
                    const currentTime = Date.now();
                    const elapsed = (currentTime - this.stats.startTime) / 1000;
                    const currentCPS = elapsed > 0 ? (this.stats.hits / elapsed) : 0;
                    
                    document.getElementById('cps-live').textContent = currentCPS.toFixed(1);
                    document.getElementById('fs-cps').textContent = currentCPS.toFixed(1);
                    this.stats.cpsHistory.push(currentCPS);
                }, 500);
            }
            
            generateTargets() {
                const difficultySettings = {
                    'noob': { maxTargets: 1, spawnDelay: 1500 },
                    'intermediate': { maxTargets: 2, spawnDelay: 1000 },
                    'advanced': { maxTargets: 3, spawnDelay: 800 },
                    'pro': { maxTargets: 4, spawnDelay: 600 },
                    'insane': { maxTargets: 5, spawnDelay: 400 },
                    'godlike': { maxTargets: 7, spawnDelay: 200 }
                };
                
                const spawnRateMultiplier = {
                    'slow': 1.5,
                    'normal': 1,
                    'fast': 0.7,
                    'insane': 0.4,
                    'lightning': 0.2
                };
                
                const settings = difficultySettings[this.config.difficulty];
                const spawnDelay = settings.spawnDelay * spawnRateMultiplier[this.config.spawnRate];
                
                this.gameInterval = setInterval(() => {
                    if (this.targets.length < settings.maxTargets && this.gameActive) {
                        this.createFullscreenTarget();
                    }
                }, spawnDelay);
            }
            
            createFullscreenTarget() {
                const target = document.createElement('div');
                target.className = `fullscreen-target fs-target-${this.config.targetSize}`;
                
                // Position randomly within fullscreen area (avoid HUD)
                const targetSize = this.getTargetSize();
                const maxX = window.innerWidth - targetSize - 20;
                const maxY = window.innerHeight - targetSize - 100; // Avoid HUD area
                const minY = 100; // Avoid HUD area
                
                const x = Math.random() * maxX + 10;
                const y = Math.random() * (maxY - minY) + minY;
                
                target.style.left = x + 'px';
                target.style.top = y + 'px';
                
                // Click handler
                target.addEventListener('click', (e) => this.hitFullscreenTarget(e, target));
                
                // Auto-destroy
                const lifeTime = this.getTargetLifetime();
                setTimeout(() => {
                    if (target.parentElement && this.gameActive) {
                        target.classList.add('miss');
                        setTimeout(() => target.remove(), 600);
                        this.targets = this.targets.filter(t => t !== target);
                    }
                }, lifeTime);
                
                this.fullscreenGameArea.appendChild(target);
                this.targets.push(target);
            }
            
            getTargetSize() {
                const sizes = { 'micro': 8, 'tiny': 12, 'small': 18, 'medium': 25, 'large': 35 };
                return sizes[this.config.targetSize];
            }
            
            getTargetLifetime() {
                const baseTimes = {
                    'noob': 3000,
                    'intermediate': 2500,
                    'advanced': 2000,
                    'pro': 1500,
                    'insane': 1000
                };
                return baseTimes[this.config.difficulty];
            }
            
            hitFullscreenTarget(event, target) {
                event.stopPropagation();
                this.stats.hits++;
                this.stats.clicks++;
                
                // Visual feedback
                target.classList.add('hit');
                setTimeout(() => target.remove(), 400);
                this.targets = this.targets.filter(t => t !== target);
                
                this.updateFullscreenStats();
            }
            
            handleFullscreenClick(event) {
                if (!this.gameActive) return;
                
                // If clicked on the game area (not a target), it's a miss
                if (event.target === this.fullscreenGameArea) {
                    this.stats.misses++;
                    this.stats.clicks++;
                    this.updateFullscreenStats();
                    this.showFullscreenMissEffect(event.clientX, event.clientY);
                }
            }
            
            showFullscreenMissEffect(x, y) {
                const missEffect = document.createElement('div');
                missEffect.className = 'fullscreen-miss-effect';
                missEffect.style.left = (x - 15) + 'px';
                missEffect.style.top = (y - 15) + 'px';
                
                this.fullscreenGameArea.appendChild(missEffect);
                setTimeout(() => missEffect.remove(), 600);
            }
            
            updateFullscreenStats() {
                // Update regular stats
                document.getElementById('clicks-count').textContent = this.stats.clicks;
                document.getElementById('hits-count').textContent = this.stats.hits;
                document.getElementById('misses-count').textContent = this.stats.misses;
                
                // Update fullscreen HUD
                document.getElementById('fs-hits').textContent = this.stats.hits;
                
                const accuracy = this.stats.clicks > 0 ? 
                    Math.round((this.stats.hits / this.stats.clicks) * 100) : 100;
                document.getElementById('accuracy').textContent = accuracy + '%';
                document.getElementById('fs-accuracy').textContent = accuracy + '%';
            }
            
            endGame(isReset = false) {
                this.gameActive = false;
                clearInterval(this.timer);
                clearInterval(this.gameInterval);
                clearInterval(this.cpsInterval);
                
                // Clear targets
                this.targets.forEach(target => target.remove());
                this.targets = [];
                
                if (!isReset) {
                    this.calculateResults();
                    this.showFullscreenResults();
                    this.saveScore();
                } else {
                    this.backToTrainer();
                }
            }
            
            calculateResults() {
                const totalTime = (Date.now() - this.stats.startTime) / 1000;
                const cps = totalTime > 0 ? this.stats.hits / totalTime : 0;
                const accuracy = this.stats.clicks > 0 ? 
                    (this.stats.hits / this.stats.clicks) * 100 : 0;
                
                const aoeRating = this.getAOERating(cps, accuracy);
                const apmEquivalent = Math.round(cps * 60);
                
                this.results = {
                    cps: Math.round(cps * 10) / 10,
                    accuracy: Math.round(accuracy),
                    aoeRating,
                    apmEquivalent,
                    totalTime: Math.round(totalTime)
                };
            }
            
            getAOERating(cps, accuracy) {
                if (cps >= 4 && accuracy >= 85) return 'Pro Player';
                if (cps >= 3.5 && accuracy >= 80) return 'Expert';
                if (cps >= 2.5 && accuracy >= 70) return 'Advanced';
                if (cps >= 2 && accuracy >= 60) return 'Intermediate';
                if (cps >= 1.5 && accuracy >= 50) return 'Beginner';
                return 'Noob';
            }
            
            showFullscreenResults() {
                // Hide fullscreen game
                this.fullscreenContainer.style.display = 'none';
                
                // Show results overlay
                this.resultsOverlay.style.display = 'flex';
                
                // Populate results
                document.getElementById('overlay-accuracy').textContent = this.results.accuracy + '%';
                document.getElementById('overlay-cps').textContent = this.results.cps;
                document.getElementById('overlay-apm').textContent = this.results.apmEquivalent;
                document.getElementById('overlay-rating').textContent = this.results.aoeRating;
                
                this.generateOverlayAnalysis();
                this.generateOverlayRecommendations();
            }
            
            generateOverlayAnalysis() {
                const analysis = document.getElementById('overlay-analysis');
                let content = '<div class="analysis-items">';
                
                if (this.results.accuracy >= 80) {
                    content += '<div class="analysis-item positive">✅ Excelente precisión para AOE</div>';
                } else if (this.results.accuracy >= 60) {
                    content += '<div class="analysis-item neutral">⚠️ Precisión mejorable, sigue practicando</div>';
                } else {
                    content += '<div class="analysis-item negative">❌ Enfócate más en precisión que velocidad</div>';
                }
                
                if (this.results.cps >= 3) {
                    content += '<div class="analysis-item positive">✅ Velocidad competitiva para ranked</div>';
                } else if (this.results.cps >= 2) {
                    content += '<div class="analysis-item neutral">⚠️ Velocidad promedio, puedes mejorar</div>';
                } else {
                    content += '<div class="analysis-item negative">❌ Necesitas entrenar más velocidad</div>';
                }
                
                if (this.results.apmEquivalent >= 180) {
                    content += '<div class="analysis-item positive">✅ APM excelente para micro-management</div>';
                } else {
                    content += '<div class="analysis-item neutral">⚠️ APM suficiente pero mejorable</div>';
                }
                
                content += '</div>';
                analysis.innerHTML = content;
            }
            
            generateOverlayRecommendations() {
                const recommendations = document.getElementById('overlay-recommendations');
                let content = '<div class="recommendation-items">';
                
                if (this.results.accuracy < 70) {
                    content += '<div class="recommendation-item">🎯 Entrena con targets más grandes hasta conseguir +80% precisión</div>';
                }
                
                if (this.results.cps < 2.5) {
                    content += '<div class="recommendation-item">⚡ Practica sesiones cortas pero frecuentes para ganar velocidad</div>';
                }
                
                if (this.results.aoeRating === 'Noob' || this.results.aoeRating === 'Beginner') {
                    content += '<div class="recommendation-item">📚 Combina este entrenamiento con partidas reales de AOE</div>';
                }
                
                content += '<div class="recommendation-item">🔥 ¡Entrena diariamente 10-15 minutos para ver mejoras rápidas!</div>';
                content += '</div>';
                recommendations.innerHTML = content;
            }
            
            saveScore() {
                const scores = JSON.parse(localStorage.getItem('aoe-clicking-advanced-scores') || '[]');
                
                const newScore = {
                    date: new Date().toLocaleDateString(),
                    time: new Date().toLocaleTimeString(),
                    mode: this.currentMode,
                    ...this.results,
                    config: { ...this.config }
                };
                
                scores.push(newScore);
                scores.sort((a, b) => (b.cps * b.accuracy) - (a.cps * a.accuracy));
                scores.splice(10); // Keep top 10
                
                localStorage.setItem('aoe-clicking-advanced-scores', JSON.stringify(scores));
                this.displayLeaderboard(scores);
            }
            
            loadLeaderboard() {
                const scores = JSON.parse(localStorage.getItem('aoe-clicking-advanced-scores') || '[]');
                this.displayLeaderboard(scores);
            }
            
            displayLeaderboard(scores) {
                const leaderboardList = document.getElementById('leaderboard-list');
                
                if (scores.length === 0) {
                    leaderboardList.innerHTML = `
                        <div class="no-records">
                            <p>🎯 ¡Aún no tienes records!</p>
                            <p>Completa tu primer entrenamiento para empezar a trackear tu progreso.</p>
                        </div>
                    `;
                    return;
                }
                
                leaderboardList.innerHTML = scores.map((score, index) => `
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank">#${index + 1}</div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-title">${score.aoeRating}</div>
                            <div class="leaderboard-date">${score.date} - ${score.time}</div>
                        </div>
                        <div class="leaderboard-stats">
                            <div class="leaderboard-stat">
                                <div class="value">${score.cps}</div>
                                <div class="label">CPS</div>
                            </div>
                            <div class="leaderboard-stat">
                                <div class="value">${score.accuracy}%</div>
                                <div class="label">Precisión</div>
                            </div>
                            <div class="leaderboard-stat">
                                <div class="value">${score.apmEquivalent}</div>
                                <div class="label">APM</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            filterLeaderboard(filter) {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                
                const scores = JSON.parse(localStorage.getItem('aoe-clicking-advanced-scores') || '[]');
                const filteredScores = filter === 'all' ? scores : scores.filter(score => score.mode === filter);
                this.displayLeaderboard(filteredScores);
            }
        }
        
        // Initialize trainer
        console.log('Document readyState:', document.readyState);
        
        function initializeTrainer() {
            console.log('Initializing trainer...');
            window.trainer = new AdvancedClickingTrainer();
            console.log('Trainer initialized:', window.trainer);
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeTrainer);
        } else {
            initializeTrainer();
        }
    </script>

    <style>
        /* Estilos específicos para el modo dodge */
        #player-unit {
            position: absolute;
            width: 15px;
            height: 15px;
            background: radial-gradient(circle, #00ff88, #00cc66);
            border: 2px solid #ffffff;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
            z-index: 100;
            transition: all 0.1s ease-out;
        }

        #dodge-hud {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            z-index: 200;
            min-width: 200px;
            font-size: 12px;
        }

        #dodge-hud > div {
            margin-bottom: 5px;
        }

        .projectile {
            position: absolute;
            background: radial-gradient(circle, #ff4444, #cc0000);
            border: 1px solid #ffffff;
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(255, 68, 68, 0.6);
            z-index: 50;
        }

        /* Efectos visuales para el modo dodge */
        .hit-effect {
            animation: hitFlash 0.2s ease-out;
        }

        @keyframes hitFlash {
            0% { background: radial-gradient(circle, #ff4444, #cc0000); }
            50% { background: radial-gradient(circle, #ff8888, #ff4444); }
            100% { background: radial-gradient(circle, #00ff88, #00cc66); }
        }

        @keyframes clickPulse {
            0% { 
                transform: scale(0.5);
                opacity: 1;
                border-color: #00ff88;
                box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.7);
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
                border-color: #00cc66;
                box-shadow: 0 0 0 10px rgba(0, 255, 136, 0.3);
            }
            100% { 
                transform: scale(1.5);
                opacity: 0;
                border-color: #00aa44;
                box-shadow: 0 0 0 20px rgba(0, 255, 136, 0);
            }
        }

        /* Mejoras para el análisis de resultados */
        .analysis-section .good {
            color: #4CAF50;
            font-weight: bold;
        }

        .analysis-section .average {
            color: #FF9800;
            font-weight: bold;
        }

        .analysis-section .poor {
            color: #F44336;
            font-weight: bold;
        }

        /* Cursor personalizado para el modo dodge */
        .dodge-cursor {
            cursor: crosshair !important;
        }

        /* Animación para los proyectiles */
        .projectile-spawn {
            animation: projectileSpawn 0.3s ease-out;
        }

        @keyframes projectileSpawn {
            0% { 
                transform: scale(0);
                opacity: 0;
            }
            100% { 
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Estados activos para la selección de modo */
        .trainer-mode.active-mode {
            border: 2px solid #ff6b35;
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.3);
            transform: translateY(-2px);
        }

        .mode-btn.active {
            background: #ff6b35;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        .mode-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Estilos para resultados fullscreen */
        .results-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .fullscreen-results-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .fullscreen-results-header h1 {
            color: #ff6b35;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 107, 53, 0.5);
        }

        .rating-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b35, #ff8c42);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .fullscreen-results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            max-width: 800px;
        }

        .result-card-fullscreen {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255, 107, 53, 0.3);
            backdrop-filter: blur(10px);
        }

        .result-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ff6b35;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(255, 107, 53, 0.5);
        }

        .result-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .fullscreen-results-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-fullscreen {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-fullscreen.primary {
            background: linear-gradient(135deg, #ff6b35, #ff8c42);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .btn-fullscreen.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .btn-fullscreen.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn-fullscreen.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
    </style>
</body>
</html>
